# The Authority - FiveM QBX Server Configuration (TEST - No Discord)
# Production-ready starter configuration

# Server Information
sv_hostname "The Authority RP | QBX Framework (TEST)"
sv_maxclients 32
# Load secrets (license key, API keys, DB, Discord)
exec config/secrets.cfg
# sv_master1 ""  # Commented out to make server public

# Make server discoverable
sets sv_projectName "The Authority RP"
sets sv_projectDesc "Professional QBX Roleplay Server | Jobs | Housing | Economy"

# Security: disable ScriptHook
sv_scriptHookAllowed 0

# Network Configuration
endpoint_add_tcp "0.0.0.0:30120"
endpoint_add_udp "0.0.0.0:30120"

# txAdmin Configuration
set txAdmin-menuEnabled "true"
set txAdmin-menuDefaultKey "F11"
set txAdmin-verbose "true"
# onesync is managed by txAdmin profile settings
# set onesync on
# Database Configuration (moved to config/secrets.cfg)

# ox_inventory Configuration - Set framework to qbx for Qbox compatibility
setr inventory:framework "qbx"

# QBX Settings
set qbx:acknowledge true

# ACE Permissions
add_ace group.owner command allow
add_ace group.admin command.quit deny
add_ace group.admin command.stop deny
add_ace group.admin command.start deny
add_ace group.admin command.restart deny

# Moderator: EasyAdmin via per-identifier permissions from discord_perms; no blanket command access
add_ace group.moderator command.quit deny
add_ace group.moderator command.stop deny
add_ace group.moderator command.start deny
add_ace group.moderator command.restart deny

# Allow in-game use of refreshperms for owner/admin
add_ace group.owner command.refreshperms allow
add_ace group.admin command.refreshperms allow

# QA item/weapon commands (admin-only)
add_ace group.owner command.qa:item allow
add_ace group.admin command.qa:item allow
add_ace group.owner command.qa:weapon allow
add_ace group.admin command.qa:weapon allow

# Allow QA identifier helper for owner/admin
add_ace group.owner command.qa:ident allow
add_ace group.admin command.qa:ident allow

# Admin Assignments - Add your identifiers here
add_principal identifier.discord:436615211256905728 group.admin
add_principal identifier.license:572a937f7f8f0d185fef3535d9fe676a11dc7a3c group.owner

# Resource Ensures (DO NOT CHANGE ORDER)
# ==== Core DB ====
ensure oxmysql

# ==== Libraries / Framework ====
ensure ox_lib
ensure db_migrator
ensure qbx_core
ensure ox_inventory
ensure ox_target
ensure PolyZone
ensure pma-voice

# Voice configuration (pma-voice)
setr voice_useSendingRangeOnly true
setr voice_enableProximityCycle 1
setr voice_defaultCycle "F11"
setr voice_enableRadios 1
setr voice_enableCalls 1
setr voice_hideEndpoints 1

# ==== Authority System ====
ensure authority_season

# ==== Base Chat ====
ensure yarn
ensure webpack
ensure chat
ensure chat-theme-gtao

# ==== CFX Managers ====
ensure sessionmanager
ensure spawnmanager

# ==== World QoL ====
ensure Renewed-Banking

# ==== Onboarding ====
ensure illenium-appearance
ensure apartments

# ==== Vehicles ====
ensure qbx_vehicles
ensure qbx_vehiclekeys
ensure qbx_garages

# ==== Jobs (civilian) ====
ensure qb-delivery

# ==== Admin ====
ensure qbx_admin

# ==== Discord Integration - DISABLED FOR TESTING ====
# ensure Badger_Discord_API
# ensure discord_perms

# ==== Local Helpers & QA ====
ensure core
ensure job_patches
ensure qa_tools

# ==== Telemetry / Audit ====
ensure telemetry
ensure healthcheck
set healthcheck_port 30121
set healthcheck_interval_ms 5000
set healthcheck_fail_threshold 2

# Server Settings
sv_enforceGameBuild 2944
sets tags "qbx,roleplay,economy,jobs"
sets locale "en-US"

# OneSync Settings
# set onesync on

# Performance Settings
set sv_filterRequestControl 4
set sv_enableNetworkedSounds false
set sv_enableNetworkedPhoneExplosions false

# Disable problematic features
set sv_listingIpOverride ""
set sv_forceIndirectListing true

# Logging
set sv_logLevel 1
set sv_log 1

# QBX Admin (txAdmin-first) ACE permissions
add_ace group.admin qbxadmin.money allow
add_ace group.admin qbxadmin.job allow
add_ace group.admin qbxadmin.gang allow
add_ace group.admin qbxadmin.info allow
add_ace group.admin qbxadmin.heal allow
add_ace group.admin qbxadmin.revive allow
add_ace group.owner qbxadmin.bypassratelimit allow

